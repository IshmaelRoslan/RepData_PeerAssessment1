---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---
## Install Libraries
```{r, message=FALSE}
library(dplyr)
library(ggplot2)
```
## Loading and preprocessing the data
Download and read files
```{r read}
activity <-
  read.csv(unz("activity.zip", "activity.csv"),
           colClasses = c("double", "character", "double"))
activity$date <- as.Date(activity$date, "%Y-%m-%d")
activity <- tbl_df(activity)
```

## What is mean total number of steps taken per day?
Summarize the activity table by total steps per day.
```{r daily}
day0 <- group_by(activity, date) %>%
        summarize(steps = sum(steps, na.rm = TRUE))
```
Calculate mean and median for use in the summary statement.
```{r dailystats}
mean0 <- mean(day0$steps)
median0 <- median(day0$steps)
```
Plot histogram with a vertical line showing the median and mean.
```{r histogram0, fig.height=6,fig.width=10}
hist(
        day0$steps,
        breaks = 5,
        col = "green",
        main = "Distribution of Total Daily Steps",
        xlab = "Total Daily Steps",
        ylab = "Number of Days"
)
abline(v=mean0, col="red")
text(mean0-1000,20,paste("mean =", round(mean0, 0)),col="red")
abline(v=median0, col="blue")
text(median0+1000,20,paste("median =", round(median0, 0)),col="blue")
```

The mean and median number of steps per day are **`r round(mean0,0)`** and **`r median0`** respectively.

## What is the average daily activity pattern?
Summarize the Interval data by mean.
```{r timedata}
time <- group_by(activity,interval)
times <- summarize(time,steps=mean(steps,na.rm=TRUE))
##Variables to be used in the text below. 
maxsteps <- round(max(times$steps),0)
maxinterval <- round(as.numeric(times[which.max(times$steps),1]),0)
```
The most active interval is **`r maxinterval`** with an average of **`r maxsteps`** steps.

Now to plot the time series.
```{r timeseries,fig.height=6,fig.width=10}
g1 <- ggplot(times, aes(x=interval, y=steps)) +
        geom_line() +
        xlab("Interval") +
        ylab("Steps") +
        ggtitle("A Time Series of the Average Number of Steps")
g1
```


## Imputing missing values
There are `r sum(is.na(activity$steps))` missing values.

Define a new instance of the **activty** table called **imputed**.
Replace missing values in **imputed** with mean from the **times** table.
```{r impute}
imputed <- read.csv(unz("activity.zip", "activity.csv"),
                    colClasses = c("double", "character", "double"))
for (i in 1:nrow(imputed)) {
        if (is.na(imputed[i, 1]) == TRUE)
        {
                imputed[i, 1] <- times[match(imputed[i, 3], times$interval), 2]
        }
}
```
Check that there are now no missing values.
```{r}
summary(imputed)
```

Summarize imputed dataset.
```{r}
day1 <- group_by(imputed,date)
daytotals1 <- summarize(day1,steps = sum(steps, na.rm = TRUE))

mean1 <- mean(daytotals1$steps)
median1 <- median(daytotals1$steps)    
```
Generate new plot and original plot.
```{r imputeplot}
g2 <- ggplot(daytotals1, aes(x = steps)) +
        geom_histogram(bins = 30) +
        geom_vline(xintercept = mean1, color = "red") +
        geom_text(aes(
                x = mean1 - 2000,
                y = 10,
                label = paste("mean =", round(mean1, 0))
                
        ), color = "red") +
        geom_text(aes(
                x = median1 + 2000,
                y = 10,
                label = paste("median =", round(median1, 0))
                
        ), color = "blue") +
        geom_vline(xintercept = median1, color = "blue") +
        xlab("Total Daily Steps") +
        ylab("Number of Days") +
        ggtitle("Distribution of Total Daily Steps with Imputed missing values") +
        theme(plot.title = element_text(hjust = 0.5))
g2
```

## Are there differences in activity patterns between weekdays and weekends?
